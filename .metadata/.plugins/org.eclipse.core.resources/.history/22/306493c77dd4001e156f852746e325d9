package com.example.demo.registration.serviceimpl;

import java.util.List;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import com.example.demo.registration.client.VehicleClient;
import com.example.demo.registration.dto.UserRegistrationDto;
import com.example.demo.registration.dto.VehicleDto;
import com.example.demo.registration.model.UserRegistration;
import com.example.demo.registration.modelmapper.RegistrationMapper;
import com.example.demo.registration.repository.UserRepository;
import com.example.demo.registration.service.RegistrationService;

@Service
public class RegistrationImpl implements RegistrationService {
    @Autowired
    private UserRepository repository;
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    @Autowired
    private VehicleClient vehicleCleint;

    boolean flag;

    @Override
    public String save(UserRegistrationDto userDto) {

        List<UserRegistration> userList = repository.findAll();
        List<UserRegistrationDto> userDtoList = userList.stream()
                .map(RegistrationMapper::mapToRegistrationDto)
                .collect(Collectors.toList());

        if (userDtoList != null) {
            for (UserRegistrationDto user : userDtoList) {
                if (user.getName().equals(userDto.getName())) {
                    flag = true;
                } else {
                    flag = false;
                }
            }

            if (flag) {
                return "User already exists";
            } else {
                userDto.setPassword(passwordEncoder.encode(userDto.getPassword()));
                repository.save(RegistrationMapper.mapToRegistration(userDto));
                return "Saved User";
            }
        }
        return "Unable to process registration";
    }

	@Override
	public UserRegistrationDto getUserById(int id) {
		// TODO Auto-generated method stub
		UserRegistration user=repository.findById(id).get();
		UserRegistrationDto userDto=RegistrationMapper.mapToRegistrationDto(user);
		VehicleDto vehicleDto=vehicleCleint.getVehicleById(id);
		userDto.setVehiles(vehicleDto);
		return userDto;
	}
    

}



